{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "description": "Normalised stacked bar chart showing the distribution of vehicle types across fuel categories.",
  "width": 500,
  "height": 450,
  "data": { "url": "../data/cars_info.csv" },
  "title": {
    "text": "Vehicle Type Distribution by Fuel",
    "anchor": "start",
    "color": "#003366",
    "fontSize": 14
  },
  "params": [
    {
      "name": "selectType",
      "select": {
        "type": "point",
        "fields": ["Type"]
      },
      "bind": "legend"
    }
  ],
  "transform": [
    {
      "calculate": "split(datum.Fuel, ',')[0]",
      "as": "Fuel_clean"
    },
    {
      "aggregate": [
        { "op": "count", "as": "count" },
        { "op": "mean", "field": "Price", "as": "avg_price" },
        { "op": "mean", "field": "CC", "as": "avg_cc" }
      ],
      "groupby": ["Fuel_clean", "Type"]
    }
  ],
  "mark": { "type": "bar" },
  "encoding": {
    "x": {
      "field": "Fuel_clean",
      "type": "nominal",
      "title": "Fuel Type",
      "axis": { "labelAngle": -45 }
    },
    "y": {
      "field": "count",
      "type": "quantitative",
      "title": "Proportion of Vehicles",
      "stack": "normalize",
      "axis": { "format": ".0%" }
    },
    "color": {
      "field": "Type",
      "type": "nominal",
      "title": "Vehicle Type",
      "scale": { "scheme": "tableau10" }
    },
    "opacity": {
      "condition": { "param": "selectType", "value": 1 },
      "value": 0.2
    },
    "tooltip": [
      { "field": "Fuel_clean", "type": "nominal", "title": "Fuel Type" },
      { "field": "Type", "type": "nominal", "title": "Vehicle Type" },
      { "field": "count", "type": "quantitative", "title": "Count" },
      { "field": "avg_price", "type": "quantitative", "title": "Avg Price (USD)", "format": ",.0f" },
      { "field": "avg_cc", "type": "quantitative", "title": "Avg Engine CC", "format": ",.0f" }
    ]
  },
  "config": {
    "axis": { "labelFontSize": 10, "titleFontSize": 11 },
    "legend": { "labelFontSize": 9, "titleFontSize": 10 }
  }
}